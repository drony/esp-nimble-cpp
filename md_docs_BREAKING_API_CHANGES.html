<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>esp-nimble-cpp / NimBLE-Arduino: Breaking API Changes vs Original</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">esp-nimble-cpp / NimBLE-Arduino
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_docs_BREAKING_API_CHANGES.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Breaking API Changes vs Original </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><br />
</p>
<h1>Server API differnces</h1>
<h3>Characteristics</h3>
<p>When creating a characteristic the properties are now set with <code>NIMBLE_PROPERTY::XXXX</code> instead of <code>BLECharacteristic::XXXX</code>.</p>
<h4>Originally</h4>
<blockquote class="doxtable">
<p>BLECharacteristic::PROPERTY_READ | BLECharacteristic::PROPERTY_WRITE </p>
</blockquote>
<h4>Is Now</h4>
<blockquote class="doxtable">
<p>NIMBLE_PROPERTY::READ | NIMBLE_PROPERTY::WRITE </p>
</blockquote>
<p><br />
</p>
<h4>The full list of properties</h4>
<blockquote class="doxtable">
<p>NIMBLE_PROPERTY::READ NIMBLE_PROPERTY::READ_ENC NIMBLE_PROPERTY::READ_AUTHEN NIMBLE_PROPERTY::READ_AUTHOR NIMBLE_PROPERTY::WRITE NIMBLE_PROPERTY::WRITE_NR NIMBLE_PROPERTY::WRITE_ENC NIMBLE_PROPERTY::WRITE_AUTHEN NIMBLE_PROPERTY::WRITE_AUTHOR NIMBLE_PROPERTY::BROADCAST NIMBLE_PROPERTY::NOTIFY NIMBLE_PROPERTY::INDICATE </p>
</blockquote>
<p><br />
</p>
<h3>Descriptors</h3>
<p>Descriptors are now created using the <code><a class="el" href="class_nim_b_l_e_characteristic.html#aae014669e9ce1ad01520d68fe0cc0fda" title="Create a new BLE Descriptor associated with this characteristic. ">NimBLECharacteristic::createDescriptor()</a></code> method.</p>
<p>The previous method <code>BLECharacteristic::addDescriptor()</code> is now a private function in the library.</p>
<p>This was done because the NimBLE host automatically creates a 0x2902 descriptor if a characteristic has NOTIFY or INDICATE properties applied. Due to this fact, the library also creates one automatically for your application. The only reason to manually create this descriptor now is to assign callback functions. If you do not require this functionality you can safely exclude the manual creation of the 0x2902 descriptor.</p>
<p>For any other descriptor, (except 0x2904, see below) it should now be created just as characteristics are by using the <code><a class="el" href="class_nim_b_l_e_characteristic.html#aae014669e9ce1ad01520d68fe0cc0fda" title="Create a new BLE Descriptor associated with this characteristic. ">NimBLECharacteristic::createDescriptor</a></code> method. Which are defined as: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;NimBLEDescriptor* createDescriptor(const char* uuid,</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;                                   uint32_t properties = </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;                                   NIMBLE_PROPERTY::READ |</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;                                   NIMBLE_PROPERTY::WRITE,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;                                   uint16_t max_len = 100);</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;NimBLEDescriptor* createDescriptor(NimBLEUUID uuid,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;                                   uint32_t properties = </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;                                   NIMBLE_PROPERTY::READ |</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;                                   NIMBLE_PROPERTY::WRITE,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                                   uint16_t max_len = 100);</div></div><!-- fragment --><p> ##### Example </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;pDescriptor = pCharacteristic-&gt;createDescriptor(&quot;ABCD&quot;, </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;                                                NIMBLE_PROPERTY::READ | </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;                                                NIMBLE_PROPERTY::WRITE |</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;                                                NIMBLE_PROPERTY::WRITE_ENC,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;                                                25);</div></div><!-- fragment --><p> Would create a descriptor with the UUID 0xABCD, publicly readable but only writable if paired/bonded (encrypted) and has a max value length of 25 bytes. <br />
</p>
<p>For the 0x2904 and 0x2902 descriptor, there is a special class that is created when you call <code>createDescriptor("2904")</code>or <code>createDescriptor("2902")</code>.</p>
<p>The pointer returned is of the base class <code><a class="el" href="class_nim_b_l_e_descriptor.html" title="A model of a BLE descriptor. ">NimBLEDescriptor</a></code> but the call will create the derived class of <code><a class="el" href="class_nim_b_l_e2904.html" title="Descriptor for Characteristic Presentation Format. ">NimBLE2904</a></code> or <code><a class="el" href="class_nim_b_l_e2902.html" title="Descriptor for Client Characteristic Configuration. ">NimBLE2902</a></code> so you must cast the returned pointer to <code><a class="el" href="class_nim_b_l_e2904.html" title="Descriptor for Characteristic Presentation Format. ">NimBLE2904</a></code> or <code><a class="el" href="class_nim_b_l_e2902.html" title="Descriptor for Client Characteristic Configuration. ">NimBLE2902</a></code> to access the specific class methods.</p>
<p>##### Example </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;p2904 = (NimBLE2904*)pCharacteristic-&gt;createDescriptor(&quot;2904&quot;);</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;p2902 = (NimBLE2902*)pCharacteristic-&gt;createDescriptor(&quot;2902&quot;);</div></div><!-- fragment --><p> <br />
</p>
<h3>Server Security</h3>
<p>Security is set on the characteristic or descriptor properties by applying one of the following: </p><blockquote class="doxtable">
<p>NIMBLE_PROPERTY::READ_ENC NIMBLE_PROPERTY::READ_AUTHEN NIMBLE_PROPERTY::READ_AUTHOR NIMBLE_PROPERTY::WRITE_ENC NIMBLE_PROPERTY::WRITE_AUTHEN NIMBLE_PROPERTY::WRITE_AUTHOR </p>
</blockquote>
<p>When a peer wants to read or write a characteristic or descriptor with any of these properties applied it will trigger the pairing process. By default the "just-works" pairing will be performed automatically. This can be changed to use passkey authentication or numeric comparison. See <a href="#security-differences">Security Differences</a> for details.</p>
<p><br />
</p>
<h1>Client API Differences</h1>
<p>The <code><a class="el" href="class_nim_b_l_e_advertised_device_callbacks.html#af6a25e1bb773a147536b1785b2aae606" title="Called when a new scan result is detected. ">NimBLEAdvertisedDeviceCallbacks::onResult()</a></code> method now receives a pointer to the <code><a class="el" href="class_nim_b_l_e_advertised_device.html" title="A representation of a BLE advertised device found by a scan. ">NimBLEAdvertisedDevice</a></code> object instead of a copy.</p>
<p><code><a class="el" href="class_nim_b_l_e_client.html#a6e6f6d8e445448f5fde03c4ea9bc5686" title="Connect to an advertising device. ">NimBLEClient::connect()</a></code> now takes an extra parameter to indicate if the client should download the services database from the peripheral, default value is true.</p>
<p>Defined as: </p><blockquote class="doxtable">
<p><a class="el" href="class_nim_b_l_e_client.html#a6e6f6d8e445448f5fde03c4ea9bc5686" title="Connect to an advertising device. ">NimBLEClient::connect</a>(NimBLEAdvertisedDevice* device, bool refreshServices = true); <a class="el" href="class_nim_b_l_e_client.html#a6e6f6d8e445448f5fde03c4ea9bc5686" title="Connect to an advertising device. ">NimBLEClient::connect</a>(<a class="el" href="class_nim_b_l_e_address.html" title="A BLE device address. ">NimBLEAddress</a> address, uint8_t type = BLE_ADDR_PUBLIC, bool refreshServices = true); </p>
</blockquote>
<p>If set to false the client will use the services database it retrieved from the peripheral last time it connected. This allows for faster connections and power saving if the devices just dropped connection and want to reconnect. <br />
</p>
<blockquote class="doxtable">
<p><a class="el" href="class_nim_b_l_e_remote_characteristic.html#a3c8d1fd77dd074df866c091c614eafb3" title="Write the new value for the characteristic from a data buffer. ">NimBLERemoteCharacteristic::writeValue()</a>; <a class="el" href="class_nim_b_l_e_remote_characteristic.html#ab4f54eabe90a416546b7b3fc3477f49c" title="backward-compatibility method for subscribe/unsubscribe notifications/indications ...">NimBLERemoteCharacteristic::registerForNotify()</a>; </p>
</blockquote>
<p>Now return true or false to indicate success or failure so you can choose to disconnect or try again. <br />
</p>
<blockquote class="doxtable">
<p><a class="el" href="class_nim_b_l_e_remote_characteristic.html#ab4f54eabe90a416546b7b3fc3477f49c" title="backward-compatibility method for subscribe/unsubscribe notifications/indications ...">NimBLERemoteCharacteristic::registerForNotify()</a>; </p>
</blockquote>
<p>Is now <b>deprecated</b>. </p><blockquote class="doxtable">
<p><a class="el" href="class_nim_b_l_e_remote_characteristic.html#aa08b2f62376568e1fc833e4ff91e8aa7" title="Subscribe for notifications or indications. ">NimBLERemoteCharacteristic::subscribe()</a> <a class="el" href="class_nim_b_l_e_remote_characteristic.html#a6e331afdbdbc32bf461c9866236a97aa" title="Unsubscribe for notifications or indications. ">NimBLERemoteCharacteristic::unsubscribe()</a> </p>
</blockquote>
<p>Are the new methods added to replace it. <br />
</p>
<blockquote class="doxtable">
<p><a class="el" href="class_nim_b_l_e_remote_characteristic.html#ade5c6ae280c3cf36c9905be23df8f080" title="Read a byte value. ">NimBLERemoteCharacteristic::readUInt8()</a> <a class="el" href="class_nim_b_l_e_remote_characteristic.html#a181c54862bc422d8ad0b326af675922d" title="Read an unsigned 16 bit value. ">NimBLERemoteCharacteristic::readUInt16()</a> <a class="el" href="class_nim_b_l_e_remote_characteristic.html#a71793454ffab034f87af3a5e9677a63d" title="Read an unsigned 32 bit value. ">NimBLERemoteCharacteristic::readUInt32()</a> <a class="el" href="class_nim_b_l_e_remote_characteristic.html#a81f39759d48a8fb792c94e4b3b455eef" title="Read a float value. ">NimBLERemoteCharacteristic::readFloat()</a> </p>
</blockquote>
<p>Are <b>deprecated</b> and <a class="el" href="class_nim_b_l_e_remote_characteristic.html#a463760cabc9ca104a6fe094eb942fec0" title="A template to convert the remote characteristic data to &lt;type&gt;. ">NimBLERemoteCharacteristic::readValue(time_t*, bool)</a> template added to replace them. <br />
</p>
<blockquote class="doxtable">
<p>NimBLERemoteService::getCharacteristicsByHandle() </p>
</blockquote>
<p>Has been removed from the API as it is no longer maintained in the library. <br />
</p>
<blockquote class="doxtable">
<p>NimBLERemoteCharacteristic::readRawData() </p>
</blockquote>
<p>Has been removed from the API as it stored an unnecessary copy of the data. The user application should use <a class="el" href="class_nim_b_l_e_remote_characteristic.html#a7e10fa37095d7c80dc36c768fe783e67" title="Read the value of the remote characteristic. ">NimBLERemoteCharacteristic::readValue</a> or <a class="el" href="class_nim_b_l_e_remote_characteristic.html#add1a1daed14b5f3e729e284dbd369257" title="Get the value of the remote characteristic. ">NimBLERemoteCharacteristic::getValue</a>. Then cast the returned std::string to the type they wish such as: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;uint8_t *val = (uint8_t*)pChr-&gt;readValue().data();</div></div><!-- fragment --><p> <br />
</p>
<blockquote class="doxtable">
<p><a class="el" href="class_nim_b_l_e_client.html#acb9007569b3bb13b3b49f3c4cb47b21a" title="Get a pointer to the vector of found services. ">NimBLEClient::getServices</a>(bool refresh = false) <a class="el" href="class_nim_b_l_e_remote_characteristic.html#acf11d225fe5a25327742349e9d6061f9" title="Get a pointer to the vector of found descriptors. ">NimBLERemoteCharacteristic::getDescriptors</a>(bool refresh = false) <a class="el" href="class_nim_b_l_e_remote_service.html#a2c9e91c842598a6a9576c7b87af0863a" title="Get a pointer to the vector of found characteristics. ">NimBLERemoteService::getCharacteristics</a>(bool refresh = false) </p>
</blockquote>
<p>These methods now take an optional (bool) parameter and return a pointer to <code>std::vector</code> instead of <code>std::map</code>. If passed true it will clear the respective vector and retrieve all the respective attributes from the peripheral. If false(default) it will return the respective vector with the currently stored attributes.</p>
<p><b>Removed:</b> the automatic discovery of all peripheral attributes as they consumed time and resources for data the user may not be interested in.</p>
<p><b>Added:</b> <a class="el" href="class_nim_b_l_e_client.html#a3d8cbf51caf8b3b8a0ec6ce2074ba71d" title="Retrieves the full database of attributes that the peripheral has available. ">NimBLEClient::discoverAttributes()</a> for the user to discover all the peripheral attributes to replace the the removed functionality. <br />
</p>
<blockquote class="doxtable">
<p><a class="el" href="class_nim_b_l_e_client.html#ae22379ab10bd82932d2303fb3753c366" title="Get the service BLE Remote Service instance corresponding to the uuid. ">NimBLEClient::getService()</a> <a class="el" href="class_nim_b_l_e_remote_service.html#ab12d195a2239a3808d60457184f0c487" title="Get the remote characteristic object for the characteristic UUID. ">NimBLERemoteService::getCharacteristic()</a> <a class="el" href="class_nim_b_l_e_remote_characteristic.html#a6178e1c58361b957be3c48548c1c4366" title="Get the descriptor instance with the given UUID that belongs to this characteristic. ">NimBLERemoteCharacteristic::getDescriptor()</a> </p>
</blockquote>
<p>These methods will now check the respective vectors for the attribute object and, if not found, will retrieve (only) the specified attribute from the peripheral.</p>
<p>These changes allow more control for the user to manage the resources used for the attributes. <br />
</p>
<h3>Client Security</h3>
<p>The client will automatically initiate security when the peripheral responds that it's required. The default configuration will use "just-works" pairing with no bonding, if you wish to enable bonding see below. <br />
</p>
<h1>Security Differences</h1>
<p>Security callback functions are now incorporated in the <a class="el" href="class_nim_b_l_e_server_callbacks.html" title="Callbacks associated with the operation of a BLE server. ">NimBLEServerCallbacks</a> / <a class="el" href="class_nim_b_l_e_client_callbacks.html" title="Callbacks associated with a BLE client. ">NimBLEClientCallbacks</a> classes. However backward compatibility with the original <code>BLESecurity</code> class is retained to minimize app code changes.</p>
<p>The callback methods are:</p>
<blockquote class="doxtable">
<p>bool onConfirmPIN(uint32_t pin); </p>
</blockquote>
<p>Receives the pin when using numeric comparison authentication, <code>return true;</code> to accept. <br />
</p>
<blockquote class="doxtable">
<p>uint32_t onPassKeyRequest(); </p>
</blockquote>
<p>For server callback; return the passkey expected from the client. For client callback; return the passkey to send to the server. <br />
</p>
<blockquote class="doxtable">
<p>void onAuthenticationComplete(ble_gap_conn_desc* desc); </p>
</blockquote>
<p>Authentication complete, success or failed information is in <code>desc</code>. <br />
</p>
<p>Security settings and IO capabilities are now set by the following methods of <a class="el" href="class_nim_b_l_e_device.html" title="A model of a BLE Device from which all the BLE roles are created. ">NimBLEDevice</a>. </p><blockquote class="doxtable">
<p><a class="el" href="class_nim_b_l_e_device.html#aa8e340c02418771ce72dec758d560938" title="Set the authorization mode for this device. ">NimBLEDevice::setSecurityAuth(bool bonding, bool mitm, bool sc)</a> <a class="el" href="class_nim_b_l_e_device.html#a2f10da171794581870d678fc947a5d1f" title="Set the authorization mode for this device. ">NimBLEDevice::setSecurityAuth(uint8_t auth_req)</a> </p>
</blockquote>
<p>Sets the authorization mode for this device. <br />
</p>
<blockquote class="doxtable">
<p><a class="el" href="class_nim_b_l_e_device.html#ab9fee9e810d5fa18bc8a37053eb9b5d0" title="Set the Input/Output capabilities of this device. ">NimBLEDevice::setSecurityIOCap(uint8_t iocap)</a> </p>
</blockquote>
<p>Sets the Input/Output capabilities of this device. <br />
</p>
<blockquote class="doxtable">
<p><a class="el" href="class_nim_b_l_e_device.html#a92d36c3a34d9474fa1d7f66c0e477d1e" title="If we are the initiator of the security procedure this sets the keys we will distribute. ">NimBLEDevice::setSecurityInitKey(uint8_t init_key)</a> </p>
</blockquote>
<p>If we are the initiator of the security procedure this sets the keys we will distribute. <br />
</p>
<blockquote class="doxtable">
<p><a class="el" href="class_nim_b_l_e_device.html#a57f0d4db1cc564176b23e860fce13f6a" title="Set the keys we are willing to accept during pairing. ">NimBLEDevice::setSecurityRespKey(uint8_t resp_key)</a> </p>
</blockquote>
<p>Sets the keys we are willing to accept from the peer during pairing. <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
