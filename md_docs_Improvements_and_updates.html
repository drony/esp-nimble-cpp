<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>esp-nimble-cpp / NimBLE-Arduino: Improvements and updates</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">esp-nimble-cpp / NimBLE-Arduino
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_docs_Improvements_and_updates.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Improvements and updates </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Server</h1>
<p><a class="el" href="class_nim_b_l_e_characteristic.html#aba05898f446e31222fbe509fa357c730" title="Convenience template to set the characteristic value to &lt;type&gt;val. ">NimBLECharacteristic::setValue(const T &amp;s)</a> <a class="el" href="class_nim_b_l_e_descriptor.html#a9136cc9e4b41110b3dd99d1c9553a477" title="Convenience template to set the descriptor value to &lt;type&gt;val. ">NimBLEDescriptor::setValue(const T &amp;s)</a></p>
<p>Now use a template to accomodate standard and custom types/values.</p>
<p><b>Example</b> </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;struct my_struct{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    uint8_t  one;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    uint16_t two;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    uint32_t four;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    uint64_t eight;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    float    flt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;}myStruct;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    myStruct.one = 1;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    myStruct.two = 2;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    myStruct.four = 4;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    myStruct.eight = 8;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    myStruct.flt = 1234.56;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    pCharacteristic-&gt;setValue(myStruct);</div></div><!-- fragment --><p> This will send the struct to the recieving client when read or a notification sent.</p>
<p><a class="el" href="class_nim_b_l_e_characteristic.html#a37e908d114f6ad2b4bf19c7cc4db9c54" title="Retrieve the current value of the characteristic. ">NimBLECharacteristic::getValue</a> now takes an optional timestamp parameter which will update it's value with the time the last value was recieved. In addition an overloaded template has been added to retrieve the value as a type specified by the user.</p>
<p><b>Example</b> </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;time_t timestamp;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;myStruct = pCharacteristic-&gt;getValue&lt;myStruct&gt;(&amp;timestamp); // timestamp optional</div></div><!-- fragment --><p> <br />
</p>
<p><b>Advertising will automatically start when a client disconnects.</b></p>
<p>A new method <code><a class="el" href="class_nim_b_l_e_server.html#a6bfd923ecd0ea06d5564343ab7209122" title="Set the server to automatically start advertising when a client disconnects. ">NimBLEServer::advertiseOnDisconnect(bool)</a></code> has been implemented to control this, true(default) = enabled. <br />
</p>
<p><code><a class="el" href="class_nim_b_l_e_server.html#a00c92f62f41ec1c499dfaf042b487d75" title="Remove a service from the server. ">NimBLEServer::removeService</a></code> takes an additional parameter <code>bool deleteSvc</code> that if true will delete the service and all characteristics / descriptors belonging to it and invalidating any pointers to them. If false the service is only removed from visibility by clients. The pointers to the service and it's characteristics / descriptors will remain valid and the service can be re-added in the future using <code><a class="el" href="class_nim_b_l_e_server.html#a6eda4c9e0ac1dd031c678d4bf7da1d56" title="Adds a service which was already created, but removed from availability. ">NimBLEServer::addService</a></code>. <br />
</p>
<p>New characteristic read/write callbacks added to <a class="el" href="class_nim_b_l_e_characteristic_callbacks.html" title="Callbacks that can be associated with a BLE characteristic to inform of events. ">NimBLECharacteristicCallbacks</a> that receive a pointer to the connection description of the client reading/writing. This is useful when connected to multiple clients to discern which client is performing the operation. <br />
</p>
<h1>Client</h1>
<p><a class="el" href="class_nim_b_l_e_remote_characteristic.html#a463760cabc9ca104a6fe094eb942fec0" title="A template to convert the remote characteristic data to &lt;type&gt;. ">NimBLERemoteCharacteristic::readValue(time_t*, bool)</a> <a class="el" href="class_nim_b_l_e_remote_descriptor.html#ac4e3a21818903b69ace41c36a58d3c46" title="A template to convert the remote descriptor data to &lt;type&gt;. ">NimBLERemoteDescriptor::readValue(bool)</a></p>
<p>Have been added as templates to allow reading the values as any specified type.</p>
<p><b>Example</b> </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;struct my_struct{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    uint8_t  one;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    uint16_t two;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    uint32_t four;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    uint64_t eight;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    float    flt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;}myStruct;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    time_t timestamp;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    myStruct = pRemoteCharacteristic-&gt;readValue&lt;myStruct&gt;(&amp;timestamp); // timestamp optional</div></div><!-- fragment --><p> <br />
</p>
<p><a class="el" href="class_nim_b_l_e_remote_characteristic.html#ab4f54eabe90a416546b7b3fc3477f49c" title="backward-compatibility method for subscribe/unsubscribe notifications/indications ...">NimBLERemoteCharacteristic::registerForNotify</a> Has been <b>deprecated</b> as now the internally stored characteristic value is updated when notification/indication is recieved.</p>
<p><a class="el" href="class_nim_b_l_e_remote_characteristic.html#aa08b2f62376568e1fc833e4ff91e8aa7" title="Subscribe for notifications or indications. ">NimBLERemoteCharacteristic::subscribe</a> and <a class="el" href="class_nim_b_l_e_remote_characteristic.html#a6e331afdbdbc32bf461c9866236a97aa" title="Unsubscribe for notifications or indications. ">NimBLERemoteCharacteristic::unsubscribe</a> have been implemented to replace it. A callback is no longer requred to get the most recent value unless timing is important. Instead, the application can call <a class="el" href="class_nim_b_l_e_remote_characteristic.html#add1a1daed14b5f3e729e284dbd369257" title="Get the value of the remote characteristic. ">NimBLERemoteCharacteristic::getValue</a> to get the last updated value any time.</p>
<p>In addition <a class="el" href="class_nim_b_l_e_remote_characteristic.html#a7e10fa37095d7c80dc36c768fe783e67" title="Read the value of the remote characteristic. ">NimBLERemoteCharacteristic::readValue</a> and <a class="el" href="class_nim_b_l_e_remote_characteristic.html#add1a1daed14b5f3e729e284dbd369257" title="Get the value of the remote characteristic. ">NimBLERemoteCharacteristic::getValue</a> take an optional timestamp parameter which will update it's value with the time the last value was recieved.</p>
<p><a class="el" href="class_nim_b_l_e_client.html#ae22379ab10bd82932d2303fb3753c366" title="Get the service BLE Remote Service instance corresponding to the uuid. ">NimBLEClient::getService</a> will now retrieve only the service specified and not the full database, this preserves resources otherwise wasted retrieving and allocating attributes the user application is not interested in. <br />
</p>
<h1>General</h1>
<p>To reduce resource use all instances of std::map have been replaced with std::vector.</p>
<p>Use of <a class="el" href="class_free_r_t_o_s_1_1_semaphore.html" title="A binary semaphore class that operates like a mutex, it is already given when constructed. ">FreeRTOS::Semaphore</a> has been removed as it was consuming too much ram, the related files have been left in place to accomodate application use.</p>
<p>Operators <code>==</code>, <code>!=</code> and <code>std::string</code> have been added to <a class="el" href="class_nim_b_l_e_address.html" title="A BLE device address. ">NimBLEAddress</a> and <a class="el" href="class_nim_b_l_e_u_u_i_d.html" title="A model of a BLE UUID. ">NimBLEUUID</a> for easier comparison and logging.</p>
<p>New constructor for <a class="el" href="class_nim_b_l_e_u_u_i_d.html" title="A model of a BLE UUID. ">NimBLEUUID(uint32_t, uint16_t, uint16_t, uint64_t)</a> added to lower memory use vs string construction. See: <a href="https://github.com/h2zero/NimBLE-Arduino/pull/21">#21</a>.</p>
<p>Security/pairing operations are now handled in the respective <a class="el" href="class_nim_b_l_e_client_callbacks.html" title="Callbacks associated with a BLE client. ">NimBLEClientCallbacks</a> and <a class="el" href="class_nim_b_l_e_server_callbacks.html" title="Callbacks associated with the operation of a BLE server. ">NimBLEServerCallbacks</a> classes, <a class="el" href="class_nim_b_l_e_security.html" title="A class to handle BLE security operations. Deprecated - provided for backward compatibility only...">NimBLESecurity(deprecated)</a> remains for backward compatibility.</p>
<p>Configuration options have been added to add or remove debugging information, when disabled (default) significatly reduces binary size. In ESP-IDF the options are in menuconfig: <code>Main menu -&gt; ESP-NimBLE-cpp configuration</code>. For Arduino the options must be commented / uncommented in <a class="el" href="nimconfig_8h_source.html">nimconfig.h</a>.</p>
<p>Many more internal improvements have been made as well, this is a brief overview. Refer to the class docs for futher information on class specifics. <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
